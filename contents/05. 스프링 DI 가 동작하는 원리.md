# 스프링 DI 가 동작하는 원리

스프링 DI 가 어떻게 동작하는지 깊게 파헤쳐보자. [Java Reflection](https://github.com/BAEKJungHo/java-reflection/blob/main/contents/01.%20Java%20Reflection.md) 을 배우지 않았다면 먼저 배우고 오도록 하자.

## Inversion Of Control

IoC(Inversion Of Control)는 `제어의 역전`이라고 한다. 제어의 역전이란 __프로그램의 흐름을 직접 제어하는 것이 아니라 외부에서 관리하는 것__ 을 의미한다.

```java
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.stereotype.Controller;
import com.techvu.team.TeamService;

@RequiredArgsConstructor
@RequestMapping("/team")
@Controller
public class TeamController {
  
  /**
   * @Resource(name = "teamService")
   * private TeamService teamService;
   *
   * @Autowired
   * private TeamService teamService;
   */
  private final TeamService teamService;
  
  public String join(User user) {
    
    teamService.join(user);
  }
}
```

TeamController 는 teamService 에 어떤 구현체가 들어와서 의존성이 주입되는지 신경쓰지 않고 자신이 할 일을 할 뿐이다. 
즉, 프로그램의 제어 흐름을 직접 제어하는 것이 아니라 외부에서 관리하는 것을 제어의 역전(IoC) 라고한다.

스프링은 `DI Container` 를 통해 의존 관계 주입과 관련된 프로그램의 제어 흐름 관리한다.

## DI(Dependency Injection)

의존 관계 주입(DI, Dependency Injection) 이란, 원어 그대로 해석하면 "`의존 관계를 주입한다`"라고 볼 수 있다.

의존 관계는 두 가지로 나누어 생각해야한다.

- __정적인 의존 관계__
  - import 문을 통해 알 수 있는 의존 관계
  - 컴파일 시점에 확인 가능한 의존 관계
- __동적인 의존 관계__
  - 런타임 시점에 확인 가능한 의존 관계
    - 런타임에 외부에서 실제 구현 객체를 생성하고 클라이언트에 전달해서 클라이언트와 서버의 실제 의존관계가 연결 되는 것을 의존관계 주입이라 한다.
      - 클라이언트 : TeamController
      - 서버 : TeamService
  - 의존 관계 주입을 사용하면, 클라이언트 코드를 변경하지 않고 클라이언트가 호출하는 대상(서버)의 타입 인스턴스를 변경할 수 있다.
  - 의존 관계 주입을 사용하면, 정적인 의존 관계를 변경하지 않고 클라이언트가 호출하는 대상(서버)의 타입 인스턴스를 변경할 수 있다.

위 코드를 다시 보자. 

TeamController 에서 import 문을 통해 `정적인 의존 관계`를 확인할 수 있다. 하지만 동적인 의존 관계는 런타임 시점에 확인할 수 있다. 지금까지 설명한 내용을 보면
`관계(RelationShip)`라는 말이 많이 등장한다. 설명과 함께 코드를 다시 보면 __객체들은 서로 관계를 맺고, 의사소통을 하는 것을 알 수있다.__

이 말을 조금 더 OOP 스럽게 설명하면 __객체들은 서로 관계를 맺고, 메시지를 주고 받는다.__ 라고 표현할 수 있다.

> 메시지(Message)는 객체들이 서로 의사소통 하는 것을 의미한다.

DI 는 의존성 주입이라고도 많이 부르지만, OOP 관점으로 바라보면 `의존 관계`라는 말이 더 어울리는 것을 알 수 있다.

## DI Container 

DI Container(IoC Container) 는 객체를 생성하고 의존 관계를 관리해주는 컨테이너이다. ObjectFactory 라고 부르기도 한다.

스프링에서는 `ApplicationContext` 라는 컨테이너가 존재한다. 얘가 바로 DI Container 라고 생각하면 된다. 

ApplicationContext 는 Interface 이다. 따라서 다양한 구현체를 만들 수있도록 되어있는데 크게 다음과 같다.

- __애노테이션 기반으로 스프링 컨테이너 만들기__
  - `AnnotationConfigApplicationContext`
- __XML 기반으로 스프링 컨테이너 만들기__
  - `GenericXmlApplicationContext`

우리가 스프링을 사용하면서 가장 자주 사용하는 방식은 `애노테이션 기반`으로 스프링 컨테이너를 생성한다. 

- __애노테이션 기반 스프링 컨테이너__

```java
@Configuration
public class AppConfig {

    /**
     * @Bean 어노테이션은 name 속성을 따로 지정하지 않으면
     * Ex) @Bean(name="memberService2")
     * default 로 메서드명을 name 으로 지정한다.
     */
    @Bean
    public MemberService memberService() {
        return new MemberServiceImpl(memberRepository());
    }
}
```
